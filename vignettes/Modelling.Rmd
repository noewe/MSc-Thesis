---
title: "Modelling Burger"
author: 'No√©mie Wellinger'
date: "`r Sys.Date()`"
output: html_document
---

```{r Load packages, include=FALSE, message=FALSE, warning=FALSE}}
# Decide which packages you need. For this Project you need the following:
packages <- c("ggplot2","tidyverse","lubridate",
              "dplyr","caret","vip","parsnip",
              "workflows","tune","dials","stringr","terra","stars","sf",
              "doParallel","terrainr","starsExtra", "pdp", "kableExtra", "recipes","Boruta")

source("./R/load_packages.R")
load_packages(packages)
```

```{r Load data, include=FALSE, message=FALSE, warning=FALSE}
# Load the data


```

```{r predictors}
# Define the predictors

# Take all column-names you need as predictors from the combined file except the defined
predictors <- combined |>
  dplyr::select(-c(Log_Nr,temperature,timestamp,Name,NORD_CHTOP,OST_CHTOPO,year,month,day,hour,LV_03_E,LV_03_N)) |>
  colnames()


```

```

# Variable selection

We are going to test different algorithms to select the best variables for our model. 
- Boruta
- Random forest stepwise backwards regression
- Correlation matrix

## Boruta
```{r}
temperature <- combined$temperature

# run the algorithm
bor <- Boruta::Boruta(
    y = temperature, 
    x = combined[, predictors],
    maxRuns = 30, # Number of iterations. Set to 30 or lower if it takes too long
    num.threads = parallel::detectCores()-1)

# obtain results: a data frame with all variables, ordered by their importance
df_bor <- Boruta::attStats(bor) |> 
  tibble::rownames_to_column() |> 
  dplyr::arrange(dplyr::desc(meanImp))

# plot the importance result  
ggplot2::ggplot(ggplot2::aes(x = reorder(rowname, meanImp), 
                             y = meanImp,
                             fill = decision), 
                data = df_bor) +
  ggplot2::geom_bar(stat = "identity", width = 0.75) + 
  ggplot2::scale_fill_manual(values = c("grey30", "tomato", "grey70")) + 
  ggplot2::labs(
    y = "Variable importance", 
    x = "",
    title = "Variable importance based on Boruta") +
  ggplot2::theme_classic() +
  ggplot2::coord_flip()
```
